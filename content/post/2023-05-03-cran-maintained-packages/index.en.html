---
title: CRAN maintained packages
author: Lluís Revilla Sancho
date: '2023-05-03'
slug: cran-maintained-packages
categories:
  - CRAN
tags:
  - CRAN
  - packages
authors:
  - admin
description: 'Looking at XML and RCurl impact'
draft: no
editor_options:
  chunk_output_type: console
featured: no
image:
  caption: ''
  focal_point: ''
subtitle: ''
summary: 'Some analysis on the RCurl and XML dependencies.'
---



<p>The role of package managers in software is paramount for developers.
In R the CRAN team provides a platform to tests and host packages.
This means ensuring that R dependencies are up to date and software required by some packages are also available in CRAN.</p>
<p>This helps testing ~20000 packages frequently (daily for most packages) in several architectures and R versions.
In addition, they test updates for compatibility with the dependencies and test and review new packages.</p>
<p>Most of the work with packages is automated but often requires human intervention (<a href="https://journal.r-project.org/news/RJ-2022-4-cran/#cran-package-submissions">50% of the submisions</a>).
Another consuming activity is keeping up packages abandoned by their original maintainers.</p>
<p>While newer packages are <a href="https://llrs.dev/post/2021/12/07/reasons-cran-archivals/">archived from CRAN often</a>, some old packages were adopted by CRAN.
The <a href="https://cran.r-project.org/CRAN_team.htm">CRAN team</a> is <a href="https://mastodon.social/@henrikbengtsson/110186925898457474">looking for help</a> maintining those.</p>
<p>In this post I’ll explore the packages maintained by CRAN.</p>
<div id="cran-in-packages" class="section level1">
<h1>CRAN in packages</h1>
<pre class="r"><code>packages_db &lt;- as.data.frame(tools::CRAN_package_db())
cran_author &lt;- grep(&quot;CRAN Team&quot;, x = packages_db$Author, ignore.case = TRUE)
cran_authorsR &lt;- grep(&quot;CRAN Team&quot;, x = packages_db$`Authors@R`, ignore.case = TRUE)
CRAN_TEAM_mentioned &lt;- union(cran_author, cran_authorsR)
unique(packages_db$Package[CRAN_TEAM_mentioned])
## [1] &quot;fBasics&quot;   &quot;fMultivar&quot; &quot;geiger&quot;    &quot;plotrix&quot;   &quot;RCurl&quot;     &quot;RJSONIO&quot;  
## [7] &quot;udunits2&quot;  &quot;XML&quot;</code></pre>
<p>In some of these package the CRAN team appears as contributors because they provided help/code to fix bugs:</p>
<ul>
<li><a href="https://cran.r-project.org/package=geiger">geiger</a></li>
<li><a href="https://cran.r-project.org/package=fMultivar">fMultivar</a></li>
<li><a href="https://cran.r-project.org/package=fBasics">fBasics</a></li>
<li><a href="https://cran.r-project.org/package=udunits2">udunits2</a></li>
</ul>
<p>In others they are the maintainers:</p>
<ul>
<li><a href="https://cran.r-project.org/package=XML">XML</a></li>
<li><a href="https://cran.r-project.org/package=RCurl">RCurl</a></li>
<li><a href="https://cran.r-project.org/package=RJSONIO">RJSONIO</a></li>
</ul>
<p>From these three packages RJSONIO is the newest (first release in 2010) and requires less updates (lately 1 or 2 a year).
However, in 2022 RCurl and XML required 4 and 5 updates respectively.
I will focus on these packages as these are the ones they are looking for new maintainers.</p>
</div>
<div id="rcurl-and-xml" class="section level1">
<h1>RCurl and XML</h1>
<div id="circular-dependency" class="section level2">
<h2>Circular dependency</h2>
<p>Both XML and RCurl depend on each other.</p>
<p>We can see that the packages are direct dependencies of one of their direct dependencies!
How can be that?
If we go the the <a href="https://cran.r-project.org/package=RCurl">RCurl</a> website we see in “Suggests: XML”, and in the <a href="https://cran.r-project.org/package=XML">XML</a> website the RCurl is there too.
This circular dependency is allowed because they have each other in Suggests.</p>
<p>A first step to reduce any possible problem would be to separate them.
This would make it easier understanding which package is worth prioritizing and possible missteps will have less impact.</p>
<p>If we look at <a href="https://github.com/search?q=repo%3Acran%2FXML%20RCurl&amp;type=code">XML source code for RCurl we find</a> some code in <code>inst/</code> folder.
If these two cases were removed the package could remove its dependency to RCurl.</p>
<p>Similarly, if we look at <a href="https://github.com/search?q=repo%3Acran%2FRCurl%20XML&amp;type=code">RCurl source code for XML we find</a> some code in <code>inst/</code> folder and in some examples.
If these three cases were removed the package could remove its dependency to XML.</p>
<p>RCurl has been <a href="https://diffify.com/R/RCurl/1.95-4.9/1.98-1.12">more stable</a> than XML, which have seen <a href="https://diffify.com/R/XML/3.98-1.7/3.99-0.14">new functions added and one removed</a> since CRAN is maintaining it.</p>
</div>
<div id="relevant-data" class="section level2">
<h2>Relevant data</h2>
<p>We will look at 4 sets of data for each pacakge: <a href="#dependencies">dependencies</a>, <a href="#releases">releases</a>, <a href="#maintainers">maintainers</a> and <a href="#downloads">downloads</a>.</p>
<div id="dependencies" class="section level3">
<h3>Dependencies</h3>
<p>Both packages have some system dependencies which might make the maintenance harder.
In addition they have a large number of dependencies.
We can gather the dependencies in CRAN and Bioconductor software packages:</p>
<pre class="r"><code>library(&quot;tools&quot;)
# Look up only software dependencies in Bioconductor
options(repos = BiocManager::repositories()[c(&quot;BioCsoft&quot;, &quot;CRAN&quot;)])
ap &lt;- available.packages()
all_deps &lt;- package_dependencies(c(&quot;RCurl&quot;, &quot;XML&quot;), 
                                 reverse = TRUE, db = ap, which = &quot;all&quot;)
all_unique_deps &lt;- unique(unlist(all_deps, FALSE, FALSE))
first_deps &lt;- package_dependencies(all_unique_deps, db = ap, which = &quot;all&quot;)
first_deps_strong &lt;- package_dependencies(all_unique_deps, db = ap, which = &quot;strong&quot;)
strong &lt;- sapply(first_deps_strong, function(x){any(c(&quot;XML&quot;, &quot;RCurl&quot;) %in% x)})
deps_strong &lt;- package_dependencies(all_unique_deps, recursive = TRUE, 
                                 db = ap, which = &quot;strong&quot;)
first_rdeps &lt;- package_dependencies(all_unique_deps, 
                                   reverse = TRUE, db = ap, which = &quot;all&quot;)
deps_all &lt;- package_dependencies(all_unique_deps, recursive = TRUE, 
                                 db = ap, which = &quot;all&quot;)</code></pre>
<p>They have 495 direct dependencies (and 8 more in annotation packages in Bioconductor: recount3, ENCODExplorerData, UCSCRepeatMasker, gDNAinRNAseqData, qdap, qdapTools, metaboliteIDmapping and curatedBreastData).</p>
<p>These two packages with their dependencies are used one way or another by around 20000 packages (about 90% of CRAN and Bioconductor)!
If these packages fail the impact on the community will be huge.</p>
<p>To reduce the impact of the dependencies we should look up the direct dependencies.
But we also looked at the reverse dependencies to asses the impact of the package in the other packages.</p>
<p>Know which are these, and who maintain them will help decide what is the best course of action.</p>
</div>
<div id="releases" class="section level3">
<h3>Releases</h3>
<p>A first approach is looking into the number of releases and dates to asses if the package has an active maintainer or not:</p>
<pre class="r"><code>archive &lt;- tools:::CRAN_archive_db()[all_unique_deps]
packages &lt;- tools::CRAN_package_db()
library(&quot;dplyr&quot;)
library(&quot;BiocPkgTools&quot;)
fr &lt;- vapply(archive, function(x) {
  if (is.null(x)) {
    return(NA)
  }
  as.Date(x$mtime[1])
}, FUN.VALUE = Sys.Date())
fr_bioc &lt;- biocDownloadStats(&quot;software&quot;) |&gt; 
  filter(Package %in% all_unique_deps) |&gt; 
  firstInBioc() |&gt; 
  pull(Date, name = Package)
first_release &lt;- c(as.Date(fr[!is.na(fr)]), as.Date(fr_bioc))[all_unique_deps]
last_update &lt;- packages$Published[match(all_unique_deps, packages$Package)]
releases &lt;- vapply(archive, NROW, numeric(1L)) + 1</code></pre>
<p>We only have information about CRAN packages:<br />
Bioconductor has two releases every year, and while the maintainers can release patched versions of packages between them that information is not stored (or easily retrieved, they are still available in the <a href="https://code.bioconductor.org">git server</a>).</p>
<p>Even if Bioconductor maintainers didn’t modify the package the version number increases with each release.
But the version update in the git doesn’t propagate to users automatically unless their checks pass.
For all these reasons it doesn’t make sense to count releases of packages in Bioconductor.</p>
</div>
<div id="maintainers" class="section level3">
<h3>Maintainers</h3>
<p>Now that we know which packages are more active, we can look up for the people behind it.
This way we can prioritize working with maintainers that are known to be active<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<pre class="r"><code>maintainers &lt;- packages_db$Maintainer[match(all_unique_deps, packages_db$Package)]
maintainers &lt;- trimws(gsub(&quot;&lt;.+&gt;&quot;, &quot;&quot;, maintainers))</code></pre>
<p>Once again, the Bioconductor repository doesn’t provide a file to gather this kind of data.</p>
</div>
<div id="downloads" class="section level3">
<h3>Downloads</h3>
<p>Another variable we can use are the downloads from users of said packages.
Probably, packages more downloaded are used more and a breaking change on them will have impact on more people than other packages.</p>
<pre class="r"><code>library(&quot;cranlogs&quot;)
acd &lt;- cran_downloads(intersect(all_unique_deps, packages_db$Package), 
                          when = &quot;last-month&quot;)
cran_pkg &lt;- summarise(acd, downloads = sum(count), .by = package)
loc &lt;- Sys.setlocale(locale = &quot;C&quot;)
bioc_d &lt;- vapply(setdiff(all_unique_deps, packages_db$Package), function(x){
  pkg &lt;- pkgDownloadStats(x)
  tail(pkg$Nb_of_downloads, 1)
  }, numeric(1L))
bioc_pkg &lt;- data.frame(package = names(bioc_d), downloads = bioc_d)
downloads &lt;- rbind(bioc_pkg, cran_pkg)
rownames(downloads) &lt;- downloads$package
dwn &lt;- downloads[all_unique_deps, ]</code></pre>
<p>The logs are provided by the global mirror of CRAN (sponsored by Rstudio).<br />
The Bioconductor infrastructure which provides total number of downloads and number of downloads from distinct IPs <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
</div>
</div>
<div id="analysis" class="section level2">
<h2>Analysis</h2>
<p>We collected the data that might be relevant.
Now, we can start looking all the data gathered:</p>
<pre class="r"><code>repo &lt;- vector(&quot;character&quot;, length(all_unique_deps))
ap_deps &lt;- ap[all_unique_deps, ]
repo[startsWith(ap_deps[, &quot;Repository&quot;], &quot;https://bioc&quot;)] &lt;- &quot;Bioconductor&quot;
repo[!startsWith(ap_deps[, &quot;Repository&quot;], &quot;https://bioc&quot;)] &lt;- &quot;CRAN&quot;
deps &lt;- data.frame(package = all_unique_deps,
                   direct_dep_XML = all_unique_deps %in% all_deps$XML,
                   direct_dep_RCurl = all_unique_deps %in% all_deps$RCurl,
                   first_deps_n = lengths(first_deps),
                   deps_all_n = lengths(deps_all),
                   first_rdeps_n = lengths(first_rdeps),
                   first_deps_strong_n = lengths(first_deps_strong), 
                   deps_strong_n = lengths(deps_strong),
                   direct_strong = strong, 
                   releases = releases,
                   strong = strong, 
                   first_release = first_release,
                   last_release = last_update,
                   maintainer = maintainers,
                   downloads = dwn$downloads,
                   repository = repo) |&gt; 
  mutate(type = case_when(direct_dep_XML &amp; direct_dep_RCurl ~ &quot;both&quot;,
                          direct_dep_XML ~ &quot;XML&quot;,
                          direct_dep_RCurl ~ &quot;RCurl&quot;))
rownames(deps) &lt;- NULL
head(deps)</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="6%" />
<col width="7%" />
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="6%" />
<col width="6%" />
<col width="4%" />
<col width="3%" />
<col width="6%" />
<col width="5%" />
<col width="5%" />
<col width="4%" />
<col width="5%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">direct_dep_XML</th>
<th align="left">direct_dep_RCurl</th>
<th align="right">first_deps_n</th>
<th align="right">deps_all_n</th>
<th align="right">first_rdeps_n</th>
<th align="right">first_deps_strong_n</th>
<th align="right">deps_strong_n</th>
<th align="left">direct_strong</th>
<th align="right">releases</th>
<th align="left">strong</th>
<th align="left">first_release</th>
<th align="left">last_release</th>
<th align="left">maintainer</th>
<th align="right">downloads</th>
<th align="left">repository</th>
<th align="left">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AnnotationForge</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">26</td>
<td align="right">2456</td>
<td align="right">5</td>
<td align="right">10</td>
<td align="right">47</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">2012-02-01</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">8113</td>
<td align="left">Bioconductor</td>
<td align="left">both</td>
</tr>
<tr class="even">
<td align="left">AnnotationHubData</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">33</td>
<td align="right">2456</td>
<td align="right">4</td>
<td align="right">26</td>
<td align="right">136</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">2015-02-01</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">6619</td>
<td align="left">Bioconductor</td>
<td align="left">both</td>
</tr>
<tr class="odd">
<td align="left">autonomics</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">61</td>
<td align="right">2499</td>
<td align="right">0</td>
<td align="right">34</td>
<td align="right">104</td>
<td align="left">FALSE</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">2021-02-01</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">91</td>
<td align="left">Bioconductor</td>
<td align="left">RCurl</td>
</tr>
<tr class="even">
<td align="left">BaseSpaceR</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">2456</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">2013-02-01</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">218</td>
<td align="left">Bioconductor</td>
<td align="left">RCurl</td>
</tr>
<tr class="odd">
<td align="left">BayesSpace</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">34</td>
<td align="right">2459</td>
<td align="right">0</td>
<td align="right">24</td>
<td align="right">161</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">2020-02-01</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">221</td>
<td align="left">Bioconductor</td>
<td align="left">RCurl</td>
</tr>
<tr class="even">
<td align="left">BgeeDB</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">19</td>
<td align="right">2457</td>
<td align="right">2</td>
<td align="right">14</td>
<td align="right">71</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">2016-02-01</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">238</td>
<td align="left">Bioconductor</td>
<td align="left">RCurl</td>
</tr>
</tbody>
</table>
<p>I added some numbers and logical values that might help exploring this data.</p>
<p>We will look at the <a href="#distribution-dependencies">packages dependencies between RCurl and XML</a>, some plots to have a <a href="#overview">quick view</a></p>
<div id="distribution-dependencies" class="section level3">
<h3>Distribution dependencies</h3>
<p>Let’s see how many packages depend in each of them:</p>
<pre class="r"><code>deps |&gt; 
  summarise(Packages = n(), deps = sum(first_deps_n),
            q25 = quantile(deps_all_n, probs = 0.25),
            mean_all = mean(deps_all_n),
            q75 = quantile(deps_all_n, probs = 0.75),
            .by = c(direct_dep_XML, direct_dep_RCurl)) |&gt; 
  arrange(-Packages)</code></pre>
<table style="width:100%;">
<colgroup>
<col width="22%" />
<col width="25%" />
<col width="13%" />
<col width="7%" />
<col width="7%" />
<col width="13%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">direct_dep_XML</th>
<th align="left">direct_dep_RCurl</th>
<th align="right">Packages</th>
<th align="right">deps</th>
<th align="right">q25</th>
<th align="right">mean_all</th>
<th align="right">q75</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">235</td>
<td align="right">3584</td>
<td align="right">2456</td>
<td align="right">2365.596</td>
<td align="right">2458.5</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">193</td>
<td align="right">3187</td>
<td align="right">2456</td>
<td align="right">2320.855</td>
<td align="right">2460.0</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">67</td>
<td align="right">1216</td>
<td align="right">2456</td>
<td align="right">2423.119</td>
<td align="right">2457.5</td>
</tr>
</tbody>
</table>
<p>There are ~40 more packages depending on XML than to RCurl and just 67 to both of them.</p>
</div>
<div id="overview" class="section level3">
<h3>Overview</h3>
<p>We can plot some variables to get a quick overview of the packages:</p>
<pre class="r"><code>library(&quot;ggplot2&quot;)
library(&quot;ggrepel&quot;)
deps_wo &lt;- filter(deps, !package %in% c(&quot;XML&quot;, &quot;RCurl&quot;))
deps_wo |&gt; 
  ggplot() +
  geom_point(aes(first_deps_n, downloads, shape = type)) +
  geom_text_repel(aes(first_deps_n, downloads, label = package),
                  data = filter(deps_wo, first_deps_n &gt; 40 | downloads &gt; 10^5)) +
  theme_minimal() +
  scale_y_log10(labels = scales::label_log()) +
  labs(title = &quot;Packages and downloads&quot;, 
       x = &quot;Direct dependencies&quot;, y = &quot;Downloads&quot;, size = &quot;Packages&quot;)
## Warning: ggrepel: 1 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot1"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/plot1-1.png" alt="Direct dependencies vs downloads. Many pakcages have up to 50 packages and most have below 1000 downloads in a month." width="672" />
<p class="caption">
Figure 1: Direct dependencies vs downloads. Many pakcages have up to 50 packages and most have below 1000 downloads in a month.
</p>
</div>
<p>There is an outlier on <a href="#fig:plot1">1</a>, the mlr package has more than 10k downloads and close to 120 direct dependencies, but down to less than 15 strong dependencies !</p>
<pre class="r"><code>deps_wo |&gt; 
  ggplot() +
  geom_point(aes(first_deps_n, first_rdeps_n, shape = type)) +
  geom_text_repel(aes(first_deps_n, first_rdeps_n, label = package),
                  data = filter(deps_wo, first_deps_n &gt; 60 | first_rdeps_n &gt; 50)) +
  theme_minimal() +
  scale_y_log10(labels = scales::label_log()) +
  labs(title = &quot;Few dependencies but lots of dependents&quot;,
    x = &quot;Direct dependencies&quot;, y = &quot;Depend on them&quot;, size = &quot;Packages&quot;)
## Warning: Transformation introduced infinite values in continuous y-axis
## Transformation introduced infinite values in continuous y-axis</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot2"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/plot2-1.png" alt="Dependencies vs packages that depend on them. " width="672" />
<p class="caption">
Figure 2: Dependencies vs packages that depend on them.
</p>
</div>
<p>In general though, the packages that have more dependencies have less direct dependencies.</p>
<pre class="r"><code>library(&quot;ggplot2&quot;)
library(&quot;ggrepel&quot;)
deps_wo &lt;- filter(deps, !package %in% c(&quot;XML&quot;, &quot;RCurl&quot;))
deps_wo |&gt; 
  ggplot() +
  geom_vline(xintercept = 20, linetype = 2) +
  geom_point(aes(first_deps_strong_n, downloads, shape = repository)) +
  geom_text_repel(aes(first_deps_strong_n, downloads, label = package),
                  data = filter(deps_wo, first_deps_strong_n &gt; 20 | downloads &gt; 10^5)) +
  theme_minimal() +
  scale_y_log10(labels = scales::label_log()) +
  labs(title = &quot;Packages and downloads&quot;, 
       x = &quot;Direct strong dependencies&quot;, y = &quot;Downloads&quot;, shape = &quot;Repository&quot;)
## Warning: ggrepel: 20 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot3"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/plot3-1.png" alt="Direct strong dependencies vs downloads. Many pakcages have more than 20 direct imports." width="672" />
<p class="caption">
Figure 3: Direct strong dependencies vs downloads. Many pakcages have more than 20 direct imports.
</p>
</div>
<p>One observable effect is that many packages do not comply with current CRAN rules of having 20 strong dependencies (as <a href="https://cran.r-project.org/doc/manuals/r-devel/R-ints.html#index-_005fR_005fCHECK_005fEXCESSIVE_005fIMPORTS_005f">described in R-internals</a>).
This suggests that these CRAN packages are old or that this limit is not checked in packages updates.</p>
<pre class="r"><code>data_maintainers &lt;- deps_wo |&gt; 
  filter(!is.na(maintainer)) |&gt; 
  summarize(n = n(), downloads = sum(downloads), .by = maintainer)
data_maintainers |&gt; 
  ggplot() +
  geom_point(aes(n, downloads)) +
  geom_text_repel(aes(n, downloads, label = maintainer),
                  data = filter(data_maintainers, n &gt; 2 | downloads &gt; 10^4)) +
  scale_y_log10(labels = scales::label_log()) +
  scale_x_continuous(breaks = 1:10, minor_breaks = NULL) +
  theme_minimal() +
  labs(title = &quot;CRAN maintainers that depend on XML and RCurl&quot;,
       x = &quot;Packages&quot;, y = &quot;Downloads&quot;)
## Warning: ggrepel: 15 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:plot-maintainers"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/plot-maintainers-1.png" alt="Looking at maintainers and the number of downloads they have." width="672" />
<p class="caption">
Figure 4: Looking at maintainers and the number of downloads they have.
</p>
</div>
<p>Most maintainer have few packages, some highly used packages but some have many packages relatively highly used.</p>
</div>
<div id="finding-important-packages" class="section level3">
<h3>Finding important packages</h3>
<p>We can use a PCA to find which packages are more important.</p>
<pre class="r"><code>cols_pca &lt;-  c(4:7, 15)
pca_all &lt;- prcomp(deps_wo[, cols_pca], scale. = TRUE, center = TRUE)
summary(pca_all)
## Importance of components:
##                          PC1    PC2    PC3     PC4     PC5
## Standard deviation     1.386 1.2478 0.9458 0.65380 0.44846
## Proportion of Variance 0.384 0.3114 0.1789 0.08549 0.04022
## Cumulative Proportion  0.384 0.6954 0.8743 0.95978 1.00000
pca_data &lt;- cbind(pca_all$x, deps_wo)
ggplot(pca_data) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_point(aes(PC1, PC2, col = repository, shape = repository)) +
  geom_text_repel(aes(PC1, PC2, label = package), 
                  data = filter(pca_data, abs(PC1) &gt; 2 | abs(PC2) &gt; 2)) +
  theme_minimal() +
  theme(axis.text = element_blank()) +
  labs(title = &quot;PCA of the numeric variables&quot;)
## Warning: ggrepel: 58 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:pca-all"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/pca-all-1.png" alt="PCA of all packages." width="672" />
<p class="caption">
Figure 5: PCA of all packages.
</p>
</div>
<p>We can see in the first PCA some packages that have many downloads and/or depend on many packages.
The second one are packages with many dependencies, as explained by <code>rotation</code>:</p>
<pre class="r"><code>pca_all$rotation[, 1:2]</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">PC1</th>
<th align="right">PC2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">first_deps_n</td>
<td align="right">-0.6521642</td>
<td align="right">-0.1528947</td>
</tr>
<tr class="even">
<td align="left">deps_all_n</td>
<td align="right">-0.3304698</td>
<td align="right">-0.0549046</td>
</tr>
<tr class="odd">
<td align="left">first_rdeps_n</td>
<td align="right">0.1235972</td>
<td align="right">-0.6948659</td>
</tr>
<tr class="even">
<td align="left">first_deps_strong_n</td>
<td align="right">-0.6606765</td>
<td align="right">-0.0750116</td>
</tr>
<tr class="odd">
<td align="left">downloads</td>
<td align="right">0.1170554</td>
<td align="right">-0.6965223</td>
</tr>
</tbody>
</table>
<p>But more important is that are packages that are named in <a href="#fig:pca-all">5</a>, there is the RUnit package, markdown and rgeos that have high number of downloads and many package depend on them one way or another.</p>
<p>However we can focus on packages that without RCurl or XML wouldn’t work:</p>
<pre class="r"><code>pca_strong &lt;- prcomp(deps_wo[deps_wo$strong, cols_pca], 
                     scale. = TRUE, center = TRUE)
summary(pca_strong)
## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5
## Standard deviation     1.4198 1.3005 0.9373 0.49421 0.41258
## Proportion of Variance 0.4032 0.3382 0.1757 0.04885 0.03404
## Cumulative Proportion  0.4032 0.7414 0.9171 0.96596 1.00000
pca_data_strong &lt;- cbind(pca_strong$x, deps_wo[deps_wo$strong, ])
ggplot(pca_data_strong) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_point(aes(PC1, PC2, col = repository, shape = repository)) +
    geom_text_repel(aes(PC1, PC2, label = package), 
                  data = filter(pca_data_strong, abs(PC1) &gt; 2 | abs(PC2) &gt; 2)) +
  theme_minimal() +
  theme(axis.text = element_blank()) +
  labs(title = &quot;Important packages depending on XML and RCurl&quot;, 
       subtitle = &quot;PCA of numeric variables of strong dependencies&quot;,
       col = &quot;Repository&quot;, shape = &quot;Repository&quot;)
## Warning: ggrepel: 42 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:pca-strong"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/pca-strong-1.png" alt="PCA of packages with strong dependency to XML or RCurl." width="672" />
<p class="caption">
Figure 6: PCA of packages with strong dependency to XML or RCurl.
</p>
</div>
<p>The main packages that depend on XML and RCurl are from Biocondcutor, followed by mlr and rlist.
rlist has as dependency XML and only uses 3 functions from it.
mlr uses 5 different functions from XML.</p>
<pre class="r"><code>pca_weak &lt;- prcomp(deps_wo[!deps_wo$strong, cols_pca], 
                   scale. = TRUE, center = TRUE)
summary(pca_weak)
## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5
## Standard deviation     1.4500 1.1578 0.9901 0.63980 0.40895
## Proportion of Variance 0.4205 0.2681 0.1960 0.08187 0.03345
## Cumulative Proportion  0.4205 0.6886 0.8847 0.96655 1.00000
pca_data_weak &lt;- cbind(pca_weak$x, deps_wo[!deps_wo$strong, ])
ggplot(pca_data_weak) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_point(aes(PC1, PC2, col = type, shape = type)) +
  geom_text_repel(aes(PC1, PC2, label = package), 
                  data = filter(pca_data_weak, abs(PC1)&gt; 2 | abs(PC2) &gt; 2)) +
  theme_minimal() +
  theme(axis.text = element_blank()) +
  labs(title = &quot;PCA of packages in CRAN&quot;, col = &quot;Type&quot;, shape = &quot;Type&quot;)</code></pre>
<div class="figure"><span style="display:block;" id="fig:pca-weak"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/pca-weak-1.png" alt="Packages with weak dependency to XML or RCurl." width="672" />
<p class="caption">
Figure 7: Packages with weak dependency to XML or RCurl.
</p>
</div>
<pre class="r"><code>keep &lt;- deps_wo$repository == &quot;CRAN&quot; &amp; deps_wo$strong
pca_cran &lt;- prcomp(deps_wo[keep, cols_pca], 
                     scale. = TRUE, center = TRUE)
summary(pca_cran)
## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5
## Standard deviation     1.4174 1.3060 0.9244 0.51813 0.40278
## Proportion of Variance 0.4018 0.3412 0.1709 0.05369 0.03245
## Cumulative Proportion  0.4018 0.7430 0.9139 0.96755 1.00000
pca_data_strong &lt;- cbind(pca_cran$x, deps_wo[keep, ])
ggplot(pca_data_strong) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_point(aes(PC1, PC2, col = type, shape = type)) +
    geom_text_repel(aes(PC1, PC2, label = package), 
                  data = filter(pca_data_strong, abs(PC1) &gt; 2 | abs(PC2) &gt; 2)) +
  theme_minimal() +
  theme(axis.text = element_blank()) +
  labs(title = &quot;Packages in CRAN&quot;, 
       col = &quot;Type&quot;, shape = &quot;Type&quot;)
## Warning: ggrepel: 26 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:pca-cran"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/pca-cran-1.png" alt="PCA of packages on CRAN." width="672" />
<p class="caption">
Figure 8: PCA of packages on CRAN.
</p>
</div>
<pre class="r"><code>keep &lt;- deps_wo$repository == &quot;Bioconductor&quot;  &amp; deps_wo$strong
pca_bioc &lt;- prcomp(deps_wo[keep, cols_pca], 
                     scale. = TRUE, center = TRUE)
summary(pca_bioc)
## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5
## Standard deviation     1.4913 1.3703 0.8495 0.33584 0.25281
## Proportion of Variance 0.4448 0.3755 0.1443 0.02256 0.01278
## Cumulative Proportion  0.4448 0.8203 0.9647 0.98722 1.00000
pca_data_strong &lt;- cbind(pca_bioc$x, deps_wo[keep, ])
ggplot(pca_data_strong) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_point(aes(PC1, PC2, col = type, shape = type)) +
    geom_text_repel(aes(PC1, PC2, label = package), 
                  data = filter(pca_data_strong, abs(PC1) &gt; 2 | abs(PC2) &gt; 2)) +
  theme_minimal() +
  theme(axis.text = element_blank()) +
  labs(title = &quot;Packages in Bioconductor&quot;, 
       subtitle = &quot;PCA of numeric variables of strong dependencies&quot;,
       col = &quot;Type&quot;, shape = &quot;Type&quot;)
## Warning: ggrepel: 4 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="figure"><span style="display:block;" id="fig:pca-bioc"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/pca-bioc-1.png" alt="PCA of packages on Bioconductor." width="672" />
<p class="caption">
Figure 9: PCA of packages on Bioconductor.
</p>
</div>
<p>GenomeInfoDb is the package that seems more important that only uses the <code>RCurl::getURL</code> function.</p>
</div>
</div>
<div id="outro" class="section level2">
<h2>Outro</h2>
<p>I wanted to explore a bit how these packages got into this position <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<pre class="r"><code>deps |&gt; 
  filter(strong) |&gt; 
  ggplot() +
  geom_vline(xintercept = as.Date(&quot;2013-06-15&quot;), linetype = 2) +
  geom_point(aes(first_release, downloads, col = type, shape = type, 
                 size = first_deps_strong_n)) +
  geom_label(aes(first_release, downloads, label = package),
             data = filter(deps, package %in% c(&quot;XML&quot;, &quot;RCurl&quot;)), show.legend = FALSE) +
  theme_minimal() +
  scale_y_log10(labels = scales::label_log()) +
  annotate(&quot;text&quot;, x = as.Date(&quot;2014-6-15&quot;), y = 5*10^5, 
           label = &quot;CRAN maintained&quot;, hjust = 0) +
  labs(x = &quot;Release date&quot;, y = &quot;Downloads&quot;, 
       title = &quot;More packages added after CRAN maintenance than before&quot;,
       subtitle = &quot;Release date and downloads&quot;,
       col = &quot;Depends on&quot;, shape = &quot;Depends on&quot;, size = &quot;Direct strong dependencies&quot;) 
## Warning: Removed 34 rows containing missing values (`geom_point()`).</code></pre>
<div class="figure"><span style="display:block;" id="fig:deps-time"></span>
<img src="{{< blogdown/postref >}}index.en_files/figure-html/deps-time-1.png" alt="First release of packages in relation to the maintenance by CRAN of XML and RCurl." width="672" />
<p class="caption">
Figure 10: First release of packages in relation to the maintenance by CRAN of XML and RCurl.
</p>
</div>
<p>Almost the CRAN team have been maintaining these packages longer than the previous maintainer(s?).</p>
<p>Next, we look at the dependencies added after CRAN started maintaining them</p>
<pre class="r"><code>summarize(deps_wo,
          before = sum(first_release &lt;= as.Date(&quot;2013-06-15&quot;), na.rm = TRUE), 
          later = sum(first_release &gt; as.Date(&quot;2013-06-15&quot;), na.rm = TRUE),
          .by = type)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="right">before</th>
<th align="right">later</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">both</td>
<td align="right">14</td>
<td align="right">52</td>
</tr>
<tr class="even">
<td align="left">RCurl</td>
<td align="right">21</td>
<td align="right">150</td>
</tr>
<tr class="odd">
<td align="left">XML</td>
<td align="right">63</td>
<td align="right">156</td>
</tr>
</tbody>
</table>
<p>More packages have been released after CRAN is maintaining it than before.
Maybe packages authors trusted the CRAN team for their dependencies or there was no other alternative for the functionality.
This might also be explained by the expansion of CRAN (and Bioconductor) with more packages being added each day.
However, this places further pressure in the CRAN team to maintain those packages. Removing this burden might free more time for them or to dedicate to CRAN.</p>
<p>A replacement for XML could be <a href="https://cran.r-project.org/package=xml2">xml2</a>, first released in 2015 (which uses the same system dependency libxml2).<br />
A replacement for RCurl could be <a href="https://cran.r-project.org/package=curl">curl</a>, first released at the end of 2014 (which uses the same system dependency libcurl).</p>
<p>Until their release there were no other replacement for these packages (if there are other packages, please let me know).
It is not clear to me if those packages at their first release could replace XML and RCurl.</p>
<p>This highlight the importance of correct replacement of packages in the community.
Recent examples are the efforts taken by the <a href="https://r-spatial.org/">spatial community</a> led by Roger Bivand, Edzer Pebesma.
Where packages have been carefully designed and planned to replace older packages that are going to be retired soon.</p>
</div>
</div>
<div id="recomendations" class="section level1">
<h1>Recomendations</h1>
<p>As a final recommendations I think:</p>
<ul>
<li>Disentangle the XML and RCurl circular dependency.</li>
<li>Evaluate if the xml2 and curl packages provides enough functionality to replace XML and RCurl respectively.
If not see what should be added to these packages or how to develop alternative packages to fill the gap if needed.<br />
Maybe a helping documentation about the alternative from XML and RCurl could be written to ease the transition and evaluate if the functionality is covered by these packages.</li>
<li>Contact package maintainers to replace the functionality they currently depend on XML and RCurl as seen in <a href="#fig:plot-maintainers">4</a> and the maintainers of packages seen in figures <a href="#fig:pca-all">5</a>, <a href="#fig:pca-strong">6</a>, <a href="#fig:pca-cran">8</a>, and <a href="#fig:pca-bioc">9</a>.</li>
<li>Set deprecation warnings on the XML and RCurl packages.</li>
<li>Archive XML and RCurl packages in CRAN.</li>
</ul>
<p>This might take years of moving packages around but I am confident that once the word is out, package developers will avoid XML and RCurl and current maintainers that depend on them will replace them.</p>
<p><strong>Update</strong>:</p>
<p>On 2024/01/22 the <a href="https://stat.ethz.ch/pipermail/r-package-devel/2024q1/010359.html">CRAN team asked for a maintainer of XML</a></p>
<div id="reproducibility" class="section level3">
<h3>Reproducibility</h3>
<details>
<pre><code>## - Session info ---------------------------------------------------------------
##  setting  value
##  version  R version 4.3.1 (2023-06-16)
##  os       Ubuntu 22.04.3 LTS
##  system   x86_64, linux-gnu
##  ui       X11
##  language (EN)
##  collate  C
##  ctype    C
##  tz       Europe/Madrid
##  date     2024-01-22
##  pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)
## 
## - Packages -------------------------------------------------------------------
##  package       * version     date (UTC) lib source
##  Biobase         2.62.0      2023-10-24 [1] Bioconductor
##  BiocFileCache   2.10.1      2023-10-26 [1] Bioconductor
##  BiocGenerics    0.48.1      2023-11-01 [1] Bioconductor
##  BiocManager     1.30.22     2023-08-08 [1] CRAN (R 4.3.1)
##  BiocPkgTools  * 1.20.0      2023-10-24 [1] Bioconductor
##  biocViews       1.70.0      2023-10-24 [1] Bioconductor
##  bit             4.0.5       2022-11-15 [1] CRAN (R 4.3.1)
##  bit64           4.0.5       2020-08-30 [1] CRAN (R 4.3.1)
##  bitops          1.0-7       2021-04-24 [1] CRAN (R 4.3.1)
##  blob            1.2.4       2023-03-17 [1] CRAN (R 4.3.1)
##  blogdown        1.18        2023-06-19 [1] CRAN (R 4.3.1)
##  bookdown        0.37        2023-12-01 [1] CRAN (R 4.3.1)
##  bslib           0.6.1       2023-11-28 [1] CRAN (R 4.3.1)
##  cachem          1.0.8       2023-05-01 [1] CRAN (R 4.3.1)
##  cli             3.6.2       2023-12-11 [1] CRAN (R 4.3.1)
##  codetools       0.2-19      2023-02-01 [2] CRAN (R 4.3.1)
##  colorspace      2.1-0       2023-01-23 [1] CRAN (R 4.3.1)
##  cranlogs      * 2.1.1       2019-04-29 [1] CRAN (R 4.3.1)
##  crul            1.4.0       2023-05-17 [1] CRAN (R 4.3.1)
##  curl            5.2.0       2023-12-08 [1] CRAN (R 4.3.1)
##  DBI             1.2.1       2024-01-12 [1] CRAN (R 4.3.1)
##  dbplyr          2.4.0       2023-10-26 [1] CRAN (R 4.3.2)
##  digest          0.6.34      2024-01-11 [1] CRAN (R 4.3.1)
##  dplyr         * 1.1.4       2023-11-17 [1] CRAN (R 4.3.1)
##  DT              0.31        2023-12-09 [1] CRAN (R 4.3.1)
##  evaluate        0.23        2023-11-01 [1] CRAN (R 4.3.2)
##  fansi           1.0.6       2023-12-08 [1] CRAN (R 4.3.1)
##  farver          2.1.1       2022-07-06 [1] CRAN (R 4.3.1)
##  fastmap         1.1.1       2023-02-24 [1] CRAN (R 4.3.1)
##  fauxpas         0.5.2       2023-05-03 [1] CRAN (R 4.3.1)
##  filelock        1.0.3       2023-12-11 [1] CRAN (R 4.3.1)
##  generics        0.1.3       2022-07-05 [1] CRAN (R 4.3.1)
##  ggplot2       * 3.4.4       2023-10-12 [1] CRAN (R 4.3.1)
##  ggrepel       * 0.9.5       2024-01-10 [1] CRAN (R 4.3.1)
##  gh              1.4.0       2023-02-22 [1] CRAN (R 4.3.1)
##  glue            1.7.0       2024-01-09 [1] CRAN (R 4.3.1)
##  graph           1.80.0      2023-10-24 [1] Bioconductor
##  gtable          0.3.4       2023-08-21 [1] CRAN (R 4.3.1)
##  highr           0.10        2022-12-22 [1] CRAN (R 4.3.1)
##  hms             1.1.3       2023-03-21 [1] CRAN (R 4.3.1)
##  htmltools       0.5.7       2023-11-03 [1] CRAN (R 4.3.2)
##  htmlwidgets   * 1.6.4       2023-12-06 [1] CRAN (R 4.3.1)
##  httpcode        0.3.0       2020-04-10 [1] CRAN (R 4.3.1)
##  httr            1.4.7       2023-08-15 [1] CRAN (R 4.3.1)
##  igraph          1.6.0       2023-12-11 [1] CRAN (R 4.3.1)
##  jquerylib       0.1.4       2021-04-26 [1] CRAN (R 4.3.1)
##  jsonlite        1.8.8       2023-12-04 [1] CRAN (R 4.3.1)
##  knitr         * 1.45        2023-10-30 [1] CRAN (R 4.3.2)
##  labeling        0.4.3       2023-08-29 [1] CRAN (R 4.3.2)
##  lifecycle       1.0.4       2023-11-07 [1] CRAN (R 4.3.2)
##  magrittr        2.0.3       2022-03-30 [1] CRAN (R 4.3.1)
##  memoise         2.0.1       2021-11-26 [1] CRAN (R 4.3.1)
##  munsell         0.5.0       2018-06-12 [1] CRAN (R 4.3.1)
##  pillar          1.9.0       2023-03-22 [1] CRAN (R 4.3.1)
##  pkgconfig       2.0.3       2019-09-22 [1] CRAN (R 4.3.1)
##  purrr           1.0.2       2023-08-10 [1] CRAN (R 4.3.1)
##  R6              2.5.1       2021-08-19 [1] CRAN (R 4.3.1)
##  RBGL            1.78.0      2023-10-24 [1] Bioconductor
##  Rcpp            1.0.12      2024-01-09 [1] CRAN (R 4.3.1)
##  RCurl           1.98-1.14   2024-01-09 [1] CRAN (R 4.3.1)
##  readr           2.1.5       2024-01-10 [1] CRAN (R 4.3.1)
##  rlang           1.1.3       2024-01-10 [1] CRAN (R 4.3.1)
##  rmarkdown       2.25        2023-09-18 [1] CRAN (R 4.3.1)
##  rorcid          0.7.0       2021-01-20 [1] CRAN (R 4.3.1)
##  RSQLite         2.3.5       2024-01-21 [1] CRAN (R 4.3.1)
##  rstudioapi      0.15.0      2023-07-07 [1] CRAN (R 4.3.1)
##  RUnit           0.4.32      2018-05-18 [1] CRAN (R 4.3.1)
##  rvest           1.0.3       2022-08-19 [1] CRAN (R 4.3.1)
##  sass            0.4.8       2023-12-06 [1] CRAN (R 4.3.1)
##  scales          1.3.0       2023-11-28 [1] CRAN (R 4.3.1)
##  sessioninfo     1.2.2       2021-12-06 [1] CRAN (R 4.3.1)
##  stringi         1.8.3       2023-12-11 [1] CRAN (R 4.3.1)
##  stringr         1.5.1       2023-11-14 [1] CRAN (R 4.3.1)
##  tibble          3.2.1       2023-03-20 [1] CRAN (R 4.3.1)
##  tidyselect      1.2.0       2022-10-10 [1] CRAN (R 4.3.1)
##  tzdb            0.4.0       2023-05-12 [1] CRAN (R 4.3.1)
##  utf8            1.2.4       2023-10-22 [1] CRAN (R 4.3.2)
##  vctrs           0.6.5       2023-12-01 [1] CRAN (R 4.3.1)
##  whisker         0.4.1       2022-12-05 [1] CRAN (R 4.3.1)
##  withr           3.0.0       2024-01-16 [1] CRAN (R 4.3.1)
##  xfun            0.41        2023-11-01 [1] CRAN (R 4.3.2)
##  XML             3.99-0.16.1 2024-01-22 [1] CRAN (R 4.3.1)
##  xml2            1.3.6       2023-12-04 [1] CRAN (R 4.3.1)
##  yaml            2.3.8       2023-12-11 [1] CRAN (R 4.3.1)
## 
##  [1] /home/lluis/bin/R/4.3.1
##  [2] /opt/R/4.3.1/lib/R/library
## 
## ------------------------------------------------------------------------------</code></pre>
</details>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>the <code>maintainer</code> function only works for installed packages, and I don’t have all these packages installed.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Both logs only count those of their repository and not from other mirrors or approaches (RSPM, bspm, r2u, ….).<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>I recently found this as opposite of introduction/intro.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
