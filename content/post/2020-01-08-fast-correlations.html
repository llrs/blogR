---
title: Fast correlations
author: Lluís Revilla Sancho
date: '2020-01-08'
slug: fast-correlations
categories:
  - r
tags:
  - r
authors: []
description: ''
editor_options:
  chunk_output_type: console
featured: no
image:
  caption: ''
  focal_point: ''
subtitle: ''
summary: ''
draft: true
---



<div id="correlations" class="section level2">
<h2>Correlations</h2>
<p>One of the few methods that are commonly done are correlations.
I found several implementations of Pearson correlations,
and I was curious to know if which is the fastest one.</p>
</div>
<div id="implementations" class="section level2">
<h2>Implementations</h2>
<p>So far the implementations I found are:</p>
<pre class="r"><code>stats::cor
WGCNA::cor
miRcomb::cor
coop::pcor
HiClimR::fastCor</code></pre>
<p>Most of them are on CRAN and one is at github.</p>
</div>
<div id="dependencies" class="section level1">
<h1>Dependencies</h1>
<p>If we are only interested on the correlation most of the dependencies that a package would bring aren’t rellevant.
So how many dependencies have each of those packages?</p>
<pre class="r"><code>ip &lt;- installed.packages()
dp &lt;- tools::package_dependencies(c(&quot;stats&quot;, &quot;WGCNA&quot;, &quot;miRcomb&quot;, &quot;coop&quot;, &quot;HiClimR&quot;), 
                            db = ip, which = &quot;Imports&quot;)
sort(lengths(dp), decreasing = TRUE)
##   WGCNA HiClimR   stats    coop miRcomb 
##      16       5       3       0       0</code></pre>
</div>
<div id="speed" class="section level1">
<h1>Speed</h1>
<pre class="r"><code>library(&quot;bench&quot;)
x &lt;- runif(50)
y &lt;- runif(50)
stats_cor &lt;- function() {
  stats::cor(x, y, method = &quot;pearson&quot;)
}

WGCNA_cor &lt;- function() {
  WGCNA::cor(x, y, method = &quot;pearson&quot;)[1, 1]
}

coop_cor &lt;- function() {
  coop::pcor(x, y)
}
HiClimR_cor &lt;- function() {
  HiClimR::fastCor(matrix(c(x, y), nrow = 50, ncol = 2), upperTri = FALSE, verbose = FALSE)[2, 1]
}

bm &lt;- mark(stats_cor(), WGCNA_cor(), coop_cor(), HiClimR_cor(), iterations = 10000)
## 
bm
## # A tibble: 4 x 6
##   expression         min   median `itr/sec` mem_alloc `gc/sec`
##   &lt;bch:expr&gt;    &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
## 1 stats_cor()     24.5µs     27µs    26814.    88.8KB     2.68
## 2 WGCNA_cor()     56.4µs   61.3µs    13406.   195.9MB     2.68
## 3 coop_cor()      28.1µs   29.4µs    21169.    83.3KB     2.12
## 4 HiClimR_cor()   95.5µs  104.6µs     7233.   159.1KB     2.89</code></pre>
<pre class="r"><code>plot(bm) + ggplot2::theme_bw()
## Loading required namespace: tidyr</code></pre>
<p><img src="/post/2020-01-08-fast-correlations_files/figure-html/plot-1.png" width="672" /></p>
<p>So we can see that for this basic comparison stats is king followed by coop, WGCNA, and HiClimR.</p>
<p>It might be that these other functions are optimized for matrices so lets see it again</p>
<pre class="r"><code>x &lt;- matrix(runif(100), ncol = 10, nrow = 10)
y &lt;- matrix(runif(100), ncol = 10, nrow = 10)
stats_cor2 &lt;- function() {
  stats::cor(x, x, method = &quot;pearson&quot;)
}

WGCNA_cor2 &lt;- function() {
  WGCNA::cor(x, x, method = &quot;pearson&quot;)
}

coop_cor2 &lt;- function() {
  coop::pcor(x)
}
HiClimR_cor2 &lt;- function() {
  HiClimR::fastCor(x, upperTri = FALSE, verbose = FALSE)
}

bm2 &lt;- mark(stats_cor2(), WGCNA_cor2(), coop_cor2(), HiClimR_cor2(), iterations = 10000)
bm2
## # A tibble: 4 x 6
##   expression          min   median `itr/sec` mem_alloc `gc/sec`
##   &lt;bch:expr&gt;     &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
## 1 stats_cor2()     27.6µs   28.8µs    31300.      848B     3.13
## 2 WGCNA_cor2()     54.3µs   56.5µs    16261.    3.36KB     3.25
## 3 coop_cor2()      26.1µs   27.6µs    31804.   49.82KB     3.18
## 4 HiClimR_cor2()  155.9µs  165.3µs     4889.    5.02KB     2.93</code></pre>
<pre class="r"><code>plot(bm2) + ggplot2::theme_bw()</code></pre>
<p><img src="/post/2020-01-08-fast-correlations_files/figure-html/plot2-1.png" width="672" /></p>
<p>Here we can see that coop takes the lead and stats is the second fastest followed by WGCNA and HiClimR.</p>
<div id="references" class="section level3">
<h3>References</h3>
</div>
<div id="reproducibility" class="section level3">
<h3>Reproducibility</h3>
<details>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 3.6.1 (2019-07-05)
##  os       Ubuntu 19.10                
##  system   x86_64, linux-gnu           
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       Europe/Madrid               
##  date     2020-01-25                  
## 
## ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────
##  package        * version  date       lib source        
##  acepack          1.4.1    2016-10-29 [1] CRAN (R 3.6.0)
##  AnnotationDbi    1.48.0   2019-10-29 [1] Bioconductor  
##  assertthat       0.2.1    2019-03-21 [1] CRAN (R 3.6.0)
##  backports        1.1.5    2019-10-02 [1] CRAN (R 3.6.0)
##  base64enc        0.1-3    2015-07-28 [1] CRAN (R 3.6.0)
##  beeswarm         0.2.3    2016-04-25 [1] CRAN (R 3.6.0)
##  bench          * 1.0.4    2019-09-06 [1] CRAN (R 3.6.0)
##  bibtex           0.4.2.2  2020-01-02 [1] CRAN (R 3.6.1)
##  Biobase          2.46.0   2019-10-29 [1] Bioconductor  
##  BiocGenerics     0.32.0   2019-10-29 [1] Bioconductor  
##  bit              1.1-15.1 2020-01-14 [1] CRAN (R 3.6.1)
##  bit64            0.9-7    2017-05-08 [1] CRAN (R 3.6.0)
##  blob             1.2.1    2020-01-20 [1] CRAN (R 3.6.1)
##  blogdown         0.17     2019-11-13 [1] CRAN (R 3.6.1)
##  bookdown         0.16     2019-11-22 [1] CRAN (R 3.6.1)
##  checkmate        1.9.4    2019-07-04 [1] CRAN (R 3.6.0)
##  cli              2.0.1    2020-01-08 [1] CRAN (R 3.6.1)
##  cluster          2.1.0    2019-06-19 [1] CRAN (R 3.6.0)
##  codetools        0.2-16   2018-12-24 [1] CRAN (R 3.6.0)
##  colorspace       1.4-1    2019-03-18 [1] CRAN (R 3.6.0)
##  coop             0.6-2    2019-04-22 [1] CRAN (R 3.6.1)
##  crayon           1.3.4    2017-09-16 [1] CRAN (R 3.6.0)
##  data.table       1.12.8   2019-12-09 [1] CRAN (R 3.6.1)
##  DBI              1.1.0    2019-12-15 [1] CRAN (R 3.6.1)
##  DEoptimR         1.0-8    2016-11-19 [1] CRAN (R 3.6.0)
##  digest           0.6.23   2019-11-23 [1] CRAN (R 3.6.1)
##  doParallel       1.0.15   2019-08-02 [1] CRAN (R 3.6.0)
##  dplyr            0.8.3    2019-07-04 [1] CRAN (R 3.6.0)
##  dynamicTreeCut   1.63-1   2016-03-11 [1] CRAN (R 3.6.0)
##  evaluate         0.14     2019-05-28 [1] CRAN (R 3.6.0)
##  fansi            0.4.1    2020-01-08 [1] CRAN (R 3.6.1)
##  farver           2.0.3    2020-01-16 [1] CRAN (R 3.6.1)
##  fastcluster      1.1.25   2018-06-07 [1] CRAN (R 3.6.0)
##  fit.models       0.5-14   2017-04-06 [1] CRAN (R 3.6.0)
##  foreach          1.4.7    2019-07-27 [1] CRAN (R 3.6.0)
##  foreign          0.8-74   2019-12-26 [1] CRAN (R 3.6.1)
##  Formula          1.2-3    2018-05-03 [1] CRAN (R 3.6.0)
##  ggbeeswarm       0.6.0    2017-08-07 [1] CRAN (R 3.6.0)
##  ggplot2          3.2.1    2019-08-10 [1] CRAN (R 3.6.0)
##  glue             1.3.1    2019-03-12 [1] CRAN (R 3.6.0)
##  GO.db            3.10.0   2019-11-01 [1] Bioconductor  
##  gridExtra        2.3      2017-09-09 [1] CRAN (R 3.6.0)
##  gtable           0.3.0    2019-03-25 [1] CRAN (R 3.6.0)
##  HiClimR          2.1.5    2019-12-10 [1] CRAN (R 3.6.1)
##  Hmisc            4.3-0    2019-11-07 [1] CRAN (R 3.6.1)
##  htmlTable        1.13.3   2019-12-04 [1] CRAN (R 3.6.1)
##  htmltools        0.4.0    2019-10-04 [1] CRAN (R 3.6.1)
##  htmlwidgets      1.5.1    2019-10-08 [1] CRAN (R 3.6.0)
##  httr             1.4.1    2019-08-05 [1] CRAN (R 3.6.0)
##  impute           1.60.0   2019-10-29 [1] Bioconductor  
##  IRanges          2.20.1   2019-11-20 [1] Bioconductor  
##  iterators        1.0.12   2019-07-26 [1] CRAN (R 3.6.0)
##  jpeg             0.1-8.1  2019-10-24 [1] CRAN (R 3.6.0)
##  jsonlite         1.6      2018-12-07 [1] CRAN (R 3.6.0)
##  knitcitations  * 1.0.10   2019-09-15 [1] CRAN (R 3.6.0)
##  knitr            1.27     2020-01-16 [1] CRAN (R 3.6.1)
##  lattice          0.20-38  2018-11-04 [1] CRAN (R 3.6.0)
##  latticeExtra     0.6-29   2019-12-19 [1] CRAN (R 3.6.1)
##  lazyeval         0.2.2    2019-03-15 [1] CRAN (R 3.6.0)
##  lifecycle        0.1.0    2019-08-01 [1] CRAN (R 3.6.0)
##  lubridate        1.7.4    2018-04-11 [1] CRAN (R 3.6.0)
##  magrittr         1.5      2014-11-22 [1] CRAN (R 3.6.0)
##  MASS             7.3-51.5 2019-12-20 [1] CRAN (R 3.6.1)
##  Matrix           1.2-18   2019-11-27 [1] CRAN (R 3.6.1)
##  matrixStats      0.55.0   2019-09-07 [1] CRAN (R 3.6.0)
##  memoise          1.1.0    2017-04-21 [1] CRAN (R 3.6.0)
##  munsell          0.5.0    2018-06-12 [1] CRAN (R 3.6.0)
##  mvtnorm          1.0-12   2020-01-09 [1] CRAN (R 3.6.1)
##  ncdf4            1.17     2019-10-23 [1] CRAN (R 3.6.1)
##  nnet             7.3-12   2016-02-02 [1] CRAN (R 3.6.0)
##  pcaPP            1.9-73   2018-01-14 [1] CRAN (R 3.6.0)
##  pillar           1.4.3    2019-12-20 [1] CRAN (R 3.6.1)
##  pkgconfig        2.0.3    2019-09-22 [1] CRAN (R 3.6.0)
##  plyr             1.8.5    2019-12-10 [1] CRAN (R 3.6.1)
##  png              0.1-7    2013-12-03 [1] CRAN (R 3.6.0)
##  preprocessCore   1.48.0   2019-10-29 [1] Bioconductor  
##  profmem          0.5.0    2018-01-30 [1] CRAN (R 3.6.0)
##  purrr            0.3.3    2019-10-18 [1] CRAN (R 3.6.0)
##  R6               2.4.1    2019-11-12 [1] CRAN (R 3.6.1)
##  RColorBrewer     1.1-2    2014-12-07 [1] CRAN (R 3.6.0)
##  Rcpp             1.0.3    2019-11-08 [1] CRAN (R 3.6.1)
##  RefManageR       1.2.12   2019-04-03 [1] CRAN (R 3.6.0)
##  rlang            0.4.3    2020-01-24 [1] CRAN (R 3.6.1)
##  rmarkdown        2.0      2019-12-12 [1] CRAN (R 3.6.1)
##  robust           0.4-18.2 2019-12-26 [1] CRAN (R 3.6.1)
##  robustbase       0.93-5   2019-05-12 [1] CRAN (R 3.6.0)
##  rpart            4.1-15   2019-04-12 [4] CRAN (R 3.6.1)
##  rrcov            1.5-2    2020-01-16 [1] CRAN (R 3.6.1)
##  RSQLite          2.2.0    2020-01-07 [1] CRAN (R 3.6.1)
##  rstudioapi       0.10     2019-03-19 [1] CRAN (R 3.6.0)
##  S4Vectors        0.24.1   2019-12-01 [1] Bioconductor  
##  scales           1.1.0    2019-11-18 [1] CRAN (R 3.6.1)
##  sessioninfo      1.1.1    2018-11-05 [1] CRAN (R 3.6.0)
##  stringi          1.4.5    2020-01-11 [1] CRAN (R 3.6.1)
##  stringr          1.4.0    2019-02-10 [1] CRAN (R 3.6.0)
##  survival         3.1-8    2019-12-03 [1] CRAN (R 3.6.1)
##  tibble           2.1.3    2019-06-06 [1] CRAN (R 3.6.0)
##  tidyr            1.0.2    2020-01-24 [1] CRAN (R 3.6.1)
##  tidyselect       0.2.5    2018-10-11 [1] CRAN (R 3.6.0)
##  utf8             1.1.4    2018-05-24 [1] CRAN (R 3.6.0)
##  vctrs            0.2.2    2020-01-24 [1] CRAN (R 3.6.1)
##  vipor            0.4.5    2017-03-22 [1] CRAN (R 3.6.0)
##  WGCNA            1.68     2019-05-23 [1] CRAN (R 3.6.0)
##  withr            2.1.2    2018-03-15 [1] CRAN (R 3.6.0)
##  xfun             0.12     2020-01-13 [1] CRAN (R 3.6.1)
##  xml2             1.2.2    2019-08-09 [1] CRAN (R 3.6.1)
##  yaml             2.2.0    2018-07-25 [1] CRAN (R 3.6.0)
## 
## [1] /home/lluis/R/x86_64-pc-linux-gnu-library/3.6
## [2] /usr/local/lib/R/site-library
## [3] /usr/lib/R/site-library
## [4] /usr/lib/R/library</code></pre>
</details>
</div>
</div>
